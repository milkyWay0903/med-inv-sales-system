# 药品存销管理系统功能分析报告

## 一、系统总体功能分析

### 1.1 系统概述
本系统是一个面向药品流通企业的信息管理系统，涵盖药品信息管理、供应商管理、采购管理、库存管理、销售管理等功能模块。系统通过四个核心子系统协同工作，实现药品从采购到销售的全流程闭环管理。

### 1.2 系统总体功能结构
```
药品存销管理系统
├── 药品与供应商管理子系统 (P1)
├── 采购与入库管理子系统 (P2)
├── 库存与盘点管理子系统 (P3)
└── 销售与出库管理子系统 (P4)
```

### 1.3 系统核心业务流程
1. **基础数据准备**：管理员建立药品和供应商基础信息
2. **采购流程**：采购员发起采购 → 生成采购单 → 库管员入库 → 更新库存
3. **销售流程**：销售员发起销售 → 生成销售单 → 库管员出库 → 更新库存
4. **库存管理**：库管员负责所有库存的实时更新和盘点

### 1.4 系统功能特点
- **模块化设计**：四个子系统相对独立又相互关联
- **数据一致性**：通过统一库存表确保数据一致性
- **流程闭环**：采购→入库→库存→销售→出库形成完整闭环
- **权限分离**：不同角色操作不同功能，权责分明

---

## 二、A同学：药品与供应商管理子系统功能分析 (P1)

### 2.1 子系统概述
药品与供应商管理子系统是系统的基础数据管理模块，负责维护药品信息和供应商信息，为其他子系统提供基础数据支持。

### 2.2 功能模块详细分析

#### 2.2.1 P1.1 药品信息管理功能
| 功能编号 | 功能名称     | 功能描述                         | 输入                                         | 处理过程                                                     | 输出              |
| -------- | ------------ | -------------------------------- | -------------------------------------------- | ------------------------------------------------------------ | ----------------- |
| P1.1.1   | 药品信息添加 | 向系统中添加新的药品信息         | 药品名称、规格、单位、生产厂家、类别、单价等 | 1. 验证数据完整性<br>2. 检查药品名称是否重复<br>3. 生成药品ID<br>4. 保存到药品表(D1)<br>5. 初始化库存记录 | 添加成功/失败提示 |
| P1.1.2   | 药品信息修改 | 修改系统中已有的药品信息         | 药品ID、待修改的字段                         | 1. 验证药品ID是否存在<br>2. 验证修改权限<br>3. 更新药品表(D1)对应记录<br>4. 记录修改日志 | 修改成功/失败提示 |
| P1.1.3   | 药品信息删除 | 从系统中删除药品信息（逻辑删除） | 药品ID                                       | 1. 检查药品是否有库存或关联业务<br>2. 标记药品状态为"停用"<br>3. 更新药品表(D1)状态字段 | 删除成功/失败提示 |
| P1.1.4   | 药品信息查询 | 查询药品详细信息                 | 药品ID、名称、类别等查询条件                 | 1. 根据条件从药品表(D1)检索<br>2. 关联查询库存信息(D3)<br>3. 返回查询结果集 | 药品信息列表      |

#### 2.2.2 P1.2 供应商信息管理功能
| 功能编号 | 功能名称       | 功能描述                   | 输入                             | 处理过程                                                     | 输出              |
| -------- | -------------- | -------------------------- | -------------------------------- | ------------------------------------------------------------ | ----------------- |
| P1.2.1   | 供应商信息添加 | 向系统中添加新的供应商信息 | 供应商名称、联系人、电话、地址等 | 1. 验证数据完整性<br>2. 检查供应商名称是否重复<br>3. 生成供应商ID<br>4. 保存到供应商表(D2) | 添加成功/失败提示 |
| P1.2.2   | 供应商信息修改 | 修改系统中已有的供应商信息 | 供应商ID、待修改的字段           | 1. 验证供应商ID是否存在<br>2. 验证修改权限<br>3. 更新供应商表(D2)对应记录 | 修改成功/失败提示 |
| P1.2.3   | 供应商信息删除 | 从系统中删除供应商信息     | 供应商ID                         | 1. 检查供应商是否有采购业务<br>2. 标记供应商状态为"已终止"<br>3. 更新供应商表(D2)状态字段 | 删除成功/失败提示 |
| P1.2.4   | 供应商信息查询 | 查询供应商详细信息         | 供应商ID、名称、状态等查询条件   | 1. 根据条件从供应商表(D2)检索<br>2. 返回查询结果集           | 供应商信息列表    |

### 2.3 数据交互关系
- **内部数据**：药品表(D1)、供应商表(D2)
- **外部读取**：库存表(D3) - 仅查询库存状态
- **数据流向**：
  - 药品信息 → 供采购、销售、库存子系统使用
  - 供应商信息 → 供采购子系统使用

### 2.4 功能约束条件
1. 药品信息添加时，药品名称不能重复
2. 药品删除时，需检查是否有库存或关联业务记录
3. 供应商删除时，需检查是否有采购业务记录
4. 所有操作需记录操作日志

---

## 三、B同学：采购与入库管理子系统功能分析 (P2)

### 3.1 子系统概述
采购与入库管理子系统负责药品采购流程的管理，包括库存查询、采购单生成、采购明细记录等功能，与库存管理子系统协同完成入库流程。

### 3.2 功能模块详细分析

#### 3.2.1 P2.1 库存查询功能
| 功能编号 | 功能名称     | 功能描述               | 输入                 | 处理过程                                                     | 输出         |
| -------- | ------------ | ---------------------- | -------------------- | ------------------------------------------------------------ | ------------ |
| P2.1.1   | 库存状态查询 | 查询药品当前库存状态   | 药品ID、名称、类别等 | 1. 连接药品表(D1)和库存表(D3)<br>2. 根据条件查询<br>3. 显示库存数量、位置、状态 | 库存信息列表 |
| P2.1.2   | 库存预警查询 | 查询低于最低库存的药品 | 无或药品类别筛选     | 1. 查询库存表(D3)<br>2. 筛选current_quantity < min_quantity的记录<br>3. 关联药品信息(D1) | 库存预警列表 |

#### 3.2.2 P2.2 采购请求发起功能
| 功能编号 | 功能名称       | 功能描述                 | 输入                 | 处理过程                                                     | 输出         |
| -------- | -------------- | ------------------------ | -------------------- | ------------------------------------------------------------ | ------------ |
| P2.2.1   | 采购需求确定   | 根据库存情况确定采购需求 | 药品ID、建议采购数量 | 1. 查询当前库存(D3)<br>2. 比对最低库存和最高库存<br>3. 计算建议采购量 | 采购需求建议 |
| P2.2.2   | 采购供应商选择 | 选择采购供应商           | 供应商ID、药品ID     | 1. 查询供应商表(D2)<br>2. 验证供应商状态为"合作中"<br>3. 记录选择结果 | 供应商信息   |

#### 3.2.3 P2.3 采购单生成功能
| 功能编号 | 功能名称     | 功能描述             | 输入                         | 处理过程                                                     | 输出           |
| -------- | ------------ | -------------------- | ---------------------------- | ------------------------------------------------------------ | -------------- |
| P2.3.1   | 采购单创建   | 创建新的采购单       | 供应商ID、采购日期、操作员   | 1. 生成采购单号<br>2. 创建采购单表(D4)记录<br>3. 初始状态设为"待入库" | 采购单基本信息 |
| P2.3.2   | 采购明细添加 | 向采购单添加药品明细 | 采购单ID、药品ID、数量、单价 | 1. 验证药品有效性(D1)<br>2. 验证采购数量合理性<br>3. 生成采购明细表(D5)记录<br>4. 计算明细金额 | 采购明细信息   |
| P2.3.3   | 采购单完成   | 完成采购单的编辑     | 采购单ID                     | 1. 汇总所有明细计算总金额<br>2. 更新采购单表(D4)总金额<br>3. 状态保持"待入库" | 完整的采购单   |
| P2.3.4   | 采购单查询   | 查询采购单信息       | 采购单ID、日期范围、状态     | 1. 查询采购单表(D4)<br>2. 关联供应商表(D2)<br>3. 关联采购明细表(D5)和药品表(D1) | 采购单详细信息 |

### 3.3 数据交互关系
- **内部数据**：采购单表(D4)、采购单明细表(D5)
- **外部读取**：药品表(D1)、供应商表(D2)、库存表(D3)
- **数据流向**：
  - 读取库存信息 → 确定采购需求
  - 读取供应商信息 → 选择供应商
  - 读取药品信息 → 选择采购药品
  - 写入采购单和明细 → 触发入库流程

### 3.4 功能约束条件
1. 采购单创建时，供应商必须为"合作中"状态
2. 采购明细中的药品必须为"正常"状态
3. 采购单完成前必须至少有一条采购明细
4. 采购单总金额自动计算，不能手动修改

---

## 四、C同学：库存与盘点管理子系统功能分析 (P3)

### 4.1 子系统概述
库存与盘点管理子系统是系统的核心数据管理模块，负责所有库存的实时更新、盘点调整，以及处理入库和出库请求，确保库存数据的准确性和一致性。

### 4.2 功能模块详细分析

#### 4.2.1 P3.1 入库审核处理功能
| 功能编号 | 功能名称     | 功能描述                     | 输入                   | 处理过程                                                     | 输出          |
| -------- | ------------ | ---------------------------- | ---------------------- | ------------------------------------------------------------ | ------------- |
| P3.1.1   | 入库请求接收 | 接收采购子系统产生的入库请求 | 采购单ID               | 1. 查询采购单表(D4)状态为"待入库"<br>2. 关联查询采购明细表(D5)<br>3. 显示待入库药品清单 | 待入库信息    |
| P3.1.2   | 入库审核     | 审核入库请求的合理性         | 采购单ID、审核意见     | 1. 核对采购单与实际到货<br>2. 检查药品质量和数量<br>3. 记录审核结果 | 审核通过/拒绝 |
| P3.1.3   | 入库确认     | 确认入库并触发库存更新       | 采购单ID、实际入库数量 | 1. 调用P3.2入库库存更新<br>2. 更新采购单表(D4)状态为"已完成"<br>3. 记录入库时间和操作员 | 入库完成确认  |

#### 4.2.2 P3.2 入库库存更新功能
| 功能编号 | 功能名称     | 功能描述         | 输入             | 处理过程                                                     | 输出             |
| -------- | ------------ | ---------------- | ---------------- | ------------------------------------------------------------ | ---------------- |
| P3.2.1   | 库存数量增加 | 增加药品库存数量 | 药品ID、入库数量 | 1. 查询库存表(D3)当前数量<br>2. 计算新库存量 = 当前数量 + 入库数量<br>3. 更新库存表(D3)<br>4. 记录更新时间 | 更新后的库存数量 |
| P3.2.2   | 库存状态更新 | 更新库存状态     | 药品ID           | 1. 查询更新后的库存数量<br>2. 对比最低库存和最高库存<br>3. 更新库存状态字段 | 更新后的库存状态 |

#### 4.2.3 P3.3 出库审核处理功能
| 功能编号 | 功能名称     | 功能描述                     | 输入     | 处理过程                                                     | 输出         |
| -------- | ------------ | ---------------------------- | -------- | ------------------------------------------------------------ | ------------ |
| P3.3.1   | 出库请求接收 | 接收销售子系统产生的出库请求 | 销售单ID | 1. 查询销售单表(D6)状态为"待出库"<br>2. 关联查询销售明细表(D7)<br>3. 显示待出库药品清单 | 待出库信息   |
| P3.3.2   | 库存充足检查 | 检查库存是否足够出库         | 销售单ID | 1. 遍历销售明细<br>2. 查询每种药品的当前库存(D3)<br>3. 检查库存是否充足 | 库存检查结果 |
| P3.3.3   | 出库确认     | 确认出库并触发库存更新       | 销售单ID | 1. 调用P3.4出库库存更新<br>2. 更新销售单表(D6)状态为"已完成"<br>3. 记录出库时间和操作员 | 出库完成确认 |

#### 4.2.4 P3.4 出库库存更新功能
| 功能编号 | 功能名称     | 功能描述               | 输入             | 处理过程                                                     | 输出             |
| -------- | ------------ | ---------------------- | ---------------- | ------------------------------------------------------------ | ---------------- |
| P3.4.1   | 库存数量减少 | 减少药品库存数量       | 药品ID、出库数量 | 1. 查询库存表(D3)当前数量<br>2. 检查库存是否充足<br>3. 计算新库存量 = 当前数量 - 出库数量<br>4. 更新库存表(D3)<br>5. 记录更新时间 | 更新后的库存数量 |
| P3.4.2   | 库存预警检查 | 检查出库后是否需要预警 | 药品ID           | 1. 查询更新后的库存数量<br>2. 对比最低库存<br>3. 如果低于最低库存则生成预警 | 预警信息         |

#### 4.2.5 P3.5 库存盘点功能
| 功能编号 | 功能名称     | 功能描述           | 输入                   | 处理过程                                                     | 输出         |
| -------- | ------------ | ------------------ | ---------------------- | ------------------------------------------------------------ | ------------ |
| P3.5.1   | 盘点任务创建 | 创建库存盘点任务   | 盘点范围、时间         | 1. 确定盘点药品范围<br>2. 生成盘点任务记录<br>3. 锁定相关库存记录 | 盘点任务信息 |
| P3.5.2   | 盘点数据录入 | 录入实际盘点数量   | 药品ID、实际数量       | 1. 查询系统库存数量(D3)<br>2. 录入实际盘点数量<br>3. 计算差异 = 实际数量 - 系统数量 | 盘点差异数据 |
| P3.5.3   | 盘点差异处理 | 处理盘点发现的差异 | 药品ID、差异数量、原因 | 1. 审核差异合理性<br>2. 确认调整方案<br>3. 调用库存调整功能  | 差异处理结果 |
| P3.5.4   | 盘点报告生成 | 生成盘点结果报告   | 盘点任务ID             | 1. 汇总所有盘点差异<br>2. 计算差异率和金额<br>3. 生成盘点报告 | 盘点报告     |

#### 4.2.6 P3.6 库存调整功能
| 功能编号 | 功能名称     | 功能描述         | 输入                         | 处理过程                                                     | 输出             |
| -------- | ------------ | ---------------- | ---------------------------- | ------------------------------------------------------------ | ---------------- |
| P3.6.1   | 库存数量调整 | 手动调整库存数量 | 药品ID、调整后数量、调整原因 | 1. 记录调整前数量<br>2. 更新库存表(D3)当前数量<br>3. 记录调整原因和时间 | 调整后的库存数量 |
| P3.6.2   | 库存参数设置 | 设置库存参数     | 药品ID、最低库存、最高库存   | 1. 验证参数合理性<br>2. 更新库存表(D3)参数<br>3. 触发库存状态重新计算 | 更新后的库存参数 |

### 4.3 数据交互关系
- **核心数据**：库存表(D3) - 所有操作都围绕库存表进行
- **读取数据**：药品表(D1)、采购单表(D4)、采购明细表(D5)、销售单表(D6)、销售明细表(D7)
- **数据流向**：
  - 读取采购信息 → 处理入库 → 更新库存
  - 读取销售信息 → 处理出库 → 更新库存
  - 直接操作库存表 → 盘点调整

### 4.4 功能约束条件
1. 入库前必须审核采购单与实际到货一致性
2. 出库前必须检查库存充足性
3. 库存调整必须记录调整原因
4. 盘点期间相关库存记录应锁定

---

## 五、D同学：销售与出库管理子系统功能分析 (P4)

### 5.1 子系统概述
销售与出库管理子系统负责药品销售流程的管理，包括可售库存查询、销售单生成、销售明细记录等功能，与库存管理子系统协同完成出库流程。

### 5.2 功能模块详细分析

#### 5.2.1 P4.1 可售库存查询功能
| 功能编号 | 功能名称     | 功能描述             | 输入             | 处理过程                                                     | 输出         |
| -------- | ------------ | -------------------- | ---------------- | ------------------------------------------------------------ | ------------ |
| P4.1.1   | 可售药品查询 | 查询可销售的药品信息 | 药品名称、类别等 | 1. 查询药品表(D1)状态为"正常"<br>2. 关联库存表(D3)查询库存数量<br>3. 过滤库存为0的药品 | 可售药品列表 |
| P4.1.2   | 库存详情查询 | 查询药品详细库存信息 | 药品ID           | 1. 查询药品表(D1)详细信息<br>2. 查询库存表(D3)库存信息<br>3. 返回完整库存详情 | 库存详情信息 |

#### 5.2.2 P4.2 销售请求发起功能
| 功能编号 | 功能名称     | 功能描述         | 输入               | 处理过程                                                     | 输出         |
| -------- | ------------ | ---------------- | ------------------ | ------------------------------------------------------------ | ------------ |
| P4.2.1   | 销售客户信息 | 记录销售客户信息 | 客户名称、联系方式 | 1. 记录客户信息到销售单<br>2. 验证客户信息完整性             | 客户信息记录 |
| P4.2.2   | 销售药品选择 | 选择要销售的药品 | 药品ID、销售数量   | 1. 验证药品可售性(D1)<br>2. 检查库存充足性(D3)<br>3. 获取药品销售单价 | 销售药品信息 |

#### 5.2.3 P4.3 销售单生成功能
| 功能编号 | 功能名称     | 功能描述             | 输入                       | 处理过程                                                     | 输出           |
| -------- | ------------ | -------------------- | -------------------------- | ------------------------------------------------------------ | -------------- |
| P4.3.1   | 销售单创建   | 创建新的销售单       | 客户名称、销售日期、操作员 | 1. 生成销售单号<br>2. 创建销售单表(D6)记录<br>3. 初始状态设为"待出库" | 销售单基本信息 |
| P4.3.2   | 销售明细添加 | 向销售单添加药品明细 | 销售单ID、药品ID、数量     | 1. 验证药品有效性(D1)<br>2. 验证库存充足性(D3)<br>3. 获取药品当前销售单价<br>4. 生成销售明细表(D7)记录<br>5. 计算明细金额 | 销售明细信息   |
| P4.3.3   | 销售单完成   | 完成销售单的编辑     | 销售单ID                   | 1. 汇总所有明细计算总金额<br>2. 更新销售单表(D6)总金额<br>3. 状态保持"待出库" | 完整的销售单   |
| P4.3.4   | 销售单查询   | 查询销售单信息       | 销售单ID、日期范围、状态   | 1. 查询销售单表(D6)<br>2. 关联销售明细表(D7)和药品表(D1)     | 销售单详细信息 |

### 5.3 数据交互关系
- **内部数据**：销售单表(D6)、销售单明细表(D7)
- **外部读取**：药品表(D1)、库存表(D3)
- **数据流向**：
  - 读取药品和库存信息 → 确定可售药品
  - 写入销售单和明细 → 触发出库流程

### 5.4 功能约束条件
1. 销售单创建时，客户信息不能为空
2. 销售明细中的药品必须为"正常"状态且有足够库存
3. 销售单完成前必须至少有一条销售明细
4. 销售单总金额自动计算，不能手动修改

---

## 六、系统功能交互关系总结

### 6.1 子系统间功能调用关系
| 调用方    | 被调用方  | 调用功能       | 数据传递           |
| --------- | --------- | -------------- | ------------------ |
| B同学(P2) | C同学(P3) | 触发入库流程   | 采购单ID、药品明细 |
| D同学(P4) | C同学(P3) | 触发出库流程   | 销售单ID、药品明细 |
| A/B/D同学 | A同学(P1) | 查询药品信息   | 药品ID/名称        |
| B同学(P2) | A同学(P1) | 查询供应商信息 | 供应商ID/名称      |
| B/D同学   | C同学(P3) | 查询库存信息   | 药品ID             |

### 6.2 系统功能流程闭环
1. **正向流程**：
   - A同学维护基础数据 → B同学发起采购 → C同学入库 → 库存增加
   - D同学发起销售 → C同学出库 → 库存减少

2. **数据一致性保障**：
   - 所有库存变化必须通过C同学的库存管理子系统
   - 采购和销售必须经过审核才能更新库存
   - 基础数据变更影响所有相关业务

### 6.3 功能边界划分
1. **A同学边界**：仅限于药品和供应商信息的增删改查
2. **B同学边界**：仅限于采购流程，不直接操作库存
3. **C同学边界**：所有库存操作，不涉及采购和销售业务逻辑
4. **D同学边界**：仅限于销售流程，不直接操作库存

### 6.4 异常处理机制
1. **基础数据异常**：药品或供应商被停用，相关业务不能进行
2. **库存不足异常**：销售时库存不足，销售单不能完成
3. **流程中断异常**：采购单或销售单未完成审核，流程中断
4. **数据一致性异常**：盘点发现差异，需要人工审核调整

---

## 七、系统功能实现建议

### 7.1 开发优先级建议
1. **第一阶段**：A同学的药品与供应商管理子系统（基础）
2. **第二阶段**：C同学的库存管理子系统（核心）
3. **第三阶段**：B同学的采购管理和D同学的销售管理（业务）
4. **第四阶段**：子系统联调测试

### 7.2 关键功能点提醒
1. **库存更新**：必须保证事务完整性
2. **数据验证**：所有输入数据必须验证
3. **状态管理**：各单据状态流转要清晰
4. **错误处理**：友好的错误提示和日志记录

### 7.3 测试重点
1. **单元测试**：每个功能模块单独测试
2. **集成测试**：子系统间接口测试
3. **流程测试**：完整业务流程测试
4. **异常测试**：异常情况处理测试
