# 药品存销管理系统数据库结构文档

## 文档说明

本文档基于药品存销管理系统的建表 SQL 脚本编制，详细描述了数据库的整体结构、各数据表的字段定义、索引设计、关联关系及初始数据情况，适用于系统开发、维护及数据管理参考。

## 一、数据库基本信息

| 项目       | 说明                                               |
| ---------- | -------------------------------------------------- |
| 数据库名称 | med_inv_sales                                      |
| 数据库引擎 | InnoDB（支持事务、外键约束）                       |
| 字符集     | utf8mb4（兼容全量 UTF-8 字符）                     |
| 主要用途   | 管理药品的基础信息、库存、采购、销售及系统用户数据 |

## 二、数据表结构详情

### 2.1 药品信息表（medicine）

#### 功能说明

存储药品的基础信息，为库存、采购、销售等模块提供药品维度的核心数据。

#### 字段定义

| 字段名        | 数据类型      | 主键 / 外键  | 默认值                                        | 注释                        | 约束条件   |
| ------------- | ------------- | ------------ | --------------------------------------------- | --------------------------- | ---------- |
| medicine_id   | INT           | 主键（自增） | -                                             | 药品 ID                     | 非空、唯一 |
| medicine_name | VARCHAR(100)  | -            | -                                             | 药品名称                    | 非空       |
| specification | VARCHAR(50)   | -            | NULL                                          | 规格                        | 可空       |
| unit          | VARCHAR(20)   | -            | NULL                                          | 单位（盒 / 瓶 / 支等）      | 可空       |
| manufacturer  | VARCHAR(100)  | -            | NULL                                          | 生产厂家                    | 可空       |
| category      | VARCHAR(50)   | -            | NULL                                          | 类别（抗生素 / 解热镇痛等） | 可空       |
| price         | DECIMAL(10,2) | -            | 0.00                                          | 单价                        | 可空       |
| status        | VARCHAR(10)   | -            | 正常                                          | 状态：正常 / 停用           | 可空       |
| create_time   | TIMESTAMP     | -            | CURRENT_TIMESTAMP                             | 创建时间                    | 自动生成   |
| update_time   | TIMESTAMP     | -            | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间                    | 自动更新   |

#### 索引设计

| 索引名称          | 索引类型 | 索引字段      | 说明             |
| ----------------- | -------- | ------------- | ---------------- |
| PRIMARY           | 主键索引 | medicine_id   | 唯一标识药品记录 |
| idx_medicine_name | 普通索引 | medicine_name | 加速药品名称查询 |
| idx_category      | 普通索引 | category      | 加速药品类别筛选 |

#### 初始数据

共插入 21 条药品记录，覆盖抗生素、解热镇痛、感冒用药、心脑血管等多个类别，示例：

- 阿莫西林胶囊（0.25g*24 粒，盒，华北制药，抗生素，12.50 元）
- 布洛芬缓释胶囊（0.4g*20 粒，盒，芬必得制药，解热镇痛，18.80 元）

### 2.2 供应商表（supplier）

#### 功能说明

存储药品供应商的基础信息，关联采购单表实现采购来源管理。

#### 字段定义

| 字段名        | 数据类型     | 主键 / 外键  | 默认值                                        | 注释                  | 约束条件   |
| ------------- | ------------ | ------------ | --------------------------------------------- | --------------------- | ---------- |
| supplier_id   | INT          | 主键（自增） | -                                             | 供应商 ID             | 非空、唯一 |
| supplier_name | VARCHAR(100) | -            | -                                             | 供应商名称            | 非空、唯一 |
| contact       | VARCHAR(50)  | -            | NULL                                          | 联系人                | 可空       |
| phone         | VARCHAR(20)  | -            | NULL                                          | 电话                  | 可空       |
| address       | VARCHAR(200) | -            | NULL                                          | 地址                  | 可空       |
| status        | VARCHAR(10)  | -            | 合作中                                        | 状态：合作中 / 已终止 | 可空       |
| create_time   | TIMESTAMP    | -            | CURRENT_TIMESTAMP                             | 创建时间              | 自动生成   |
| update_time   | TIMESTAMP    | -            | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间              | 自动更新   |

#### 索引设计

| 索引名称          | 索引类型 | 索引字段      | 说明               |
| ----------------- | -------- | ------------- | ------------------ |
| PRIMARY           | 主键索引 | supplier_id   | 唯一标识供应商记录 |
| idx_supplier_name | 普通索引 | supplier_name | 加速供应商名称查询 |
| uk_supplier_name  | 唯一索引 | supplier_name | 保证供应商名称唯一 |

#### 初始数据

共插入 21 条供应商记录，覆盖各药品生产厂家的代理 / 经销商，示例：

- 华北制药供应商（联系人张三，电话 13800138001，地址河北石家庄）
- 芬必得制药经销商（联系人李四，电话 13800138002，地址北京朝阳区）

### 2.3 库存表（stock）

#### 功能说明

存储药品的库存状态、数量及存放位置，关联药品表实现库存管控。

#### 字段定义

| 字段名           | 数据类型    | 主键 / 外键  | 默认值                                        | 注释                          | 约束条件       |
| ---------------- | ----------- | ------------ | --------------------------------------------- | ----------------------------- | -------------- |
| stock_id         | INT         | 主键（自增） | -                                             | 库存 ID                       | 非空、唯一     |
| medicine_id      | INT         | 外键         | -                                             | 药品 ID（关联 medicine 表）   | 非空、级联删除 |
| current_quantity | INT         | -            | 0                                             | 当前库存数量                  | 可空           |
| min_quantity     | INT         | -            | 10                                            | 最低库存量（预警阈值）        | 可空           |
| max_quantity     | INT         | -            | 1000                                          | 最高库存量（上限阈值）        | 可空           |
| location         | VARCHAR(50) | -            | NULL                                          | 存放位置（如 A 区 1 排 1 号） | 可空           |
| status           | VARCHAR(10) | -            | 正常                                          | 状态：正常 / 缺货 / 积压      | 可空           |
| update_time      | TIMESTAMP   | -            | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间                      | 自动更新       |

#### 索引设计

| 索引名称        | 索引类型 | 索引字段    | 说明             |
| --------------- | -------- | ----------- | ---------------- |
| PRIMARY         | 主键索引 | stock_id    | 唯一标识库存记录 |
| idx_medicine_id | 普通索引 | medicine_id | 加速按药品查库存 |
| idx_location    | 普通索引 | location    | 加速按位置查库存 |

#### 外键关联

| 外键字段    | 关联表   | 关联字段    | 关联策略                                    |
| ----------- | -------- | ----------- | ------------------------------------------- |
| medicine_id | medicine | medicine_id | ON DELETE CASCADE（删除药品时级联删除库存） |

#### 初始数据

共插入 21 条库存记录，与药品表一一对应，示例：

- 阿莫西林胶囊（medicine_id=1，库存 150，位置 A 区 1 排 1 号，状态正常）
- 硝酸甘油片（medicine_id=15，库存 50，位置 A 区 3 排 5 号，状态缺货）

### 2.4 采购单表（purchase_order）

#### 功能说明

存储采购单的整体信息（供应商、日期、金额、状态），作为采购明细的主表。

#### 字段定义

| 字段名        | 数据类型      | 主键 / 外键  | 默认值            | 注释                           | 约束条件       |
| ------------- | ------------- | ------------ | ----------------- | ------------------------------ | -------------- |
| purchase_id   | INT           | 主键（自增） | -                 | 采购单 ID                      | 非空、唯一     |
| supplier_id   | INT           | 外键         | -                 | 供应商 ID（关联 supplier 表）  | 非空、限制删除 |
| purchase_date | DATE          | -            | -                 | 采购日期                       | 非空           |
| total_amount  | DECIMAL(12,2) | -            | 0.00              | 总金额（由明细汇总）           | 可空           |
| status        | VARCHAR(20)   | -            | 待入库            | 状态：待入库 / 已完成 / 已取消 | 可空           |
| create_time   | TIMESTAMP     | -            | CURRENT_TIMESTAMP | 创建时间                       | 自动生成       |

#### 索引设计

| 索引名称          | 索引类型 | 索引字段      | 说明                 |
| ----------------- | -------- | ------------- | -------------------- |
| PRIMARY           | 主键索引 | purchase_id   | 唯一标识采购单记录   |
| idx_supplier_id   | 普通索引 | supplier_id   | 加速按供应商查采购单 |
| idx_purchase_date | 普通索引 | purchase_date | 加速按日期查采购单   |
| idx_status        | 普通索引 | status        | 加速按状态查采购单   |

#### 外键关联

| 外键字段    | 关联表   | 关联字段    | 关联策略                                               |
| ----------- | -------- | ----------- | ------------------------------------------------------ |
| supplier_id | supplier | supplier_id | ON DELETE RESTRICT（删除供应商时限制，需先删除采购单） |

#### 初始数据

共插入 20 条采购单记录，采购日期覆盖 2025 年 1-2 月，状态以 “已完成” 为主，1 条 “待入库”。

### 2.5 采购单明细表（purchase_detail）

#### 功能说明

存储采购单的明细信息（具体药品、数量、单价），关联采购单表和药品表。

#### 字段定义

| 字段名             | 数据类型      | 主键 / 外键  | 默认值                | 注释                                | 约束条件       |
| ------------------ | ------------- | ------------ | --------------------- | ----------------------------------- | -------------- |
| purchase_detail_id | INT           | 主键（自增） | -                     | 采购明细 ID                         | 非空、唯一     |
| purchase_id        | INT           | 外键         | -                     | 采购单 ID（关联 purchase_order 表） | 非空、级联删除 |
| medicine_id        | INT           | 外键         | -                     | 药品 ID（关联 medicine 表）         | 非空、限制删除 |
| quantity           | INT           | -            | -                     | 采购数量                            | 非空           |
| unit_price         | DECIMAL(10,2) | -            | -                     | 采购单价                            | 非空           |
| amount             | DECIMAL(10,2) | 计算字段     | quantity * unit_price | 金额（存储型计算字段）              | 自动生成       |
| remark             | VARCHAR(200)  | -            | NULL                  | 备注                                | 可空           |

#### 索引设计

| 索引名称        | 索引类型 | 索引字段           | 说明                 |
| --------------- | -------- | ------------------ | -------------------- |
| PRIMARY         | 主键索引 | purchase_detail_id | 唯一标识采购明细记录 |
| idx_purchase_id | 普通索引 | purchase_id        | 加速按采购单查明细   |
| idx_medicine_id | 普通索引 | medicine_id        | 加速按药品查采购明细 |

#### 外键关联

| 外键字段    | 关联表         | 关联字段    | 关联策略                                           |
| ----------- | -------------- | ----------- | -------------------------------------------------- |
| purchase_id | purchase_order | purchase_id | ON DELETE CASCADE（删除采购单时级联删除明细）      |
| medicine_id | medicine       | medicine_id | ON DELETE RESTRICT（删除药品时限制，需先删除明细） |

#### 初始数据

共插入 62 条采购明细记录，1 个采购单对应 3-4 条明细，金额自动计算，采购单价与药品表一致。

### 2.6 销售单表（sales_order）

#### 功能说明

存储销售单的整体信息（客户、日期、金额、状态），作为销售明细的主表。

#### 字段定义

| 字段名        | 数据类型      | 主键 / 外键  | 默认值            | 注释                           | 约束条件   |
| ------------- | ------------- | ------------ | ----------------- | ------------------------------ | ---------- |
| sales_id      | INT           | 主键（自增） | -                 | 销售单 ID                      | 非空、唯一 |
| customer_name | VARCHAR(100)  | -            | -                 | 客户名称                       | 非空       |
| sales_date    | DATE          | -            | -                 | 销售日期                       | 非空       |
| total_amount  | DECIMAL(12,2) | -            | 0.00              | 总金额（由明细汇总）           | 可空       |
| status        | VARCHAR(20)   | -            | 待出库            | 状态：待出库 / 已完成 / 已退货 | 可空       |
| create_time   | TIMESTAMP     | -            | CURRENT_TIMESTAMP | 创建时间                       | 自动生成   |

#### 索引设计

| 索引名称          | 索引类型 | 索引字段      | 说明               |
| ----------------- | -------- | ------------- | ------------------ |
| PRIMARY           | 主键索引 | sales_id      | 唯一标识销售单记录 |
| idx_customer_name | 普通索引 | customer_name | 加速按客户查销售单 |
| idx_sales_date    | 普通索引 | sales_date    | 加速按日期查销售单 |
| idx_status        | 普通索引 | status        | 加速按状态查销售单 |

#### 初始数据

共插入 20 条销售单记录，客户类型包括连锁药店、社区医院、线上平台等，销售日期覆盖 2025 年 1-3 月，1 条 “待出库”。

### 2.7 销售单明细表（sales_detail）

#### 功能说明

存储销售单的明细信息（具体药品、数量、单价），关联销售单表和药品表。

#### 字段定义

| 字段名          | 数据类型      | 主键 / 外键  | 默认值                | 注释                             | 约束条件       |
| --------------- | ------------- | ------------ | --------------------- | -------------------------------- | -------------- |
| sales_detail_id | INT           | 主键（自增） | -                     | 销售明细 ID                      | 非空、唯一     |
| sales_id        | INT           | 外键         | -                     | 销售单 ID（关联 sales_order 表） | 非空、级联删除 |
| medicine_id     | INT           | 外键         | -                     | 药品 ID（关联 medicine 表）      | 非空、限制删除 |
| quantity        | INT           | -            | -                     | 销售数量                         | 非空           |
| unit_price      | DECIMAL(10,2) | -            | -                     | 销售单价                         | 非空           |
| amount          | DECIMAL(10,2) | 计算字段     | quantity * unit_price | 金额（存储型计算字段）           | 自动生成       |
| remark          | VARCHAR(200)  | -            | NULL                  | 备注                             | 可空           |

#### 索引设计

| 索引名称        | 索引类型 | 索引字段        | 说明                 |
| --------------- | -------- | --------------- | -------------------- |
| PRIMARY         | 主键索引 | sales_detail_id | 唯一标识销售明细记录 |
| idx_sales_id    | 普通索引 | sales_id        | 加速按销售单查明细   |
| idx_medicine_id | 普通索引 | medicine_id     | 加速按药品查销售明细 |

#### 外键关联

| 外键字段    | 关联表      | 关联字段    | 关联策略                                           |
| ----------- | ----------- | ----------- | -------------------------------------------------- |
| sales_id    | sales_order | sales_id    | ON DELETE CASCADE（删除销售单时级联删除明细）      |
| medicine_id | medicine    | medicine_id | ON DELETE RESTRICT（删除药品时限制，需先删除明细） |

#### 初始数据

共插入 62 条销售明细记录，1 个销售单对应 3-4 条明细，金额自动计算，销售单价与药品表一致。

### 2.8 系统用户表（system_user）

#### 功能说明

存储系统操作用户的账号、角色、状态等信息，用于权限管控。

#### 字段定义

| 字段名      | 数据类型     | 主键 / 外键  | 默认值            | 注释                                       | 约束条件   |
| ----------- | ------------ | ------------ | ----------------- | ------------------------------------------ | ---------- |
| user_id     | INT          | 主键（自增） | -                 | 用户 ID                                    | 非空、唯一 |
| username    | VARCHAR(50)  | -            | -                 | 用户名                                     | 非空、唯一 |
| password    | VARCHAR(100) | -            | -                 | 密码（建议加密存储）                       | 非空       |
| role        | VARCHAR(20)  | -            | -                 | 角色：admin/purchaser/storekeeper/salesman | 非空       |
| real_name   | VARCHAR(50)  | -            | NULL              | 真实姓名                                   | 可空       |
| phone       | VARCHAR(20)  | -            | NULL              | 电话                                       | 可空       |
| status      | VARCHAR(10)  | -            | 正常              | 状态：正常 / 停用                          | 可空       |
| create_time | TIMESTAMP    | -            | CURRENT_TIMESTAMP | 创建时间                                   | 自动生成   |

#### 索引设计

| 索引名称    | 索引类型 | 索引字段 | 说明             |
| ----------- | -------- | -------- | ---------------- |
| PRIMARY     | 主键索引 | user_id  | 唯一标识用户记录 |
| uk_username | 唯一索引 | username | 保证用户名唯一   |
| idx_role    | 普通索引 | role     | 加速按角色查用户 |

#### 初始数据

无初始数据，需系统上线后手动添加。

## 三、数据表关联关系

### 3.1 核心关联链路

plaintext











```plaintext
supplier（供应商）1:N purchase_order（采购单）1:N purchase_detail（采购明细）N:1 medicine（药品）1:1 stock（库存）
medicine（药品）1:N sales_detail（销售明细）N:1 sales_order（销售单）
system_user（用户）无直接外键关联，通过角色管控各表操作权限
```

### 3.2 关联说明

| 关联双方                         | 关联类型 | 关联字段    | 业务含义                     |
| -------------------------------- | -------- | ----------- | ---------------------------- |
| supplier - purchase_order        | 一对多   | supplier_id | 一个供应商可对应多个采购单   |
| purchase_order - purchase_detail | 一对多   | purchase_id | 一个采购单包含多条采购明细   |
| purchase_detail - medicine       | 多对一   | medicine_id | 多条采购明细可对应同一个药品 |
| medicine - stock                 | 一对一   | medicine_id | 一个药品对应一条库存记录     |
| medicine - sales_detail          | 多对一   | medicine_id | 多条销售明细可对应同一个药品 |
| sales_detail - sales_order       | 多对一   | sales_id    | 多条销售明细归属一个销售单   |

## 四、数据维护说明

### 4.1 自动计算逻辑

1. 采购单总金额：通过 UPDATE 语句关联采购明细表，汇总`amount`字段更新至`purchase_order.total_amount`；
2. 销售单总金额：通过 UPDATE 语句关联销售明细表，汇总`amount`字段更新至`sales_order.total_amount`；
3. 采购 / 销售明细金额：通过`GENERATED ALWAYS AS (quantity * unit_price) STORED`自动计算并存储。

### 4.2 数据验证

脚本末尾提供了数据记录数验证查询，可快速核对各表初始数据是否插入成功：

sql











```sql
SELECT '药品表记录数' AS 表名, COUNT(*) AS 记录数 FROM medicine
UNION ALL
SELECT '供应商表记录数', COUNT(*) FROM supplier
UNION ALL
SELECT '库存表记录数', COUNT(*) FROM stock
UNION ALL
SELECT '采购单表记录数', COUNT(*) FROM purchase_order
UNION ALL
SELECT '采购明细表记录数', COUNT(*) FROM purchase_detail
UNION ALL
SELECT '销售单表记录数', COUNT(*) FROM sales_order
UNION ALL
SELECT '销售明细表记录数', COUNT(*) FROM sales_detail
UNION ALL
SELECT '用户表记录数', COUNT(*) FROM system_user;
```

## 五、扩展建议

1. 密码加密：`system_user.password`建议使用 MD5/SHA256 + 盐值加密存储，避免明文；
2. 日志表扩展：可新增操作日志表（如`operation_log`），记录用户对采购、销售、库存的修改操作；
3. 库存异动：新增`stock_change_log`表，记录采购入库、销售出库导致的库存数量变化；
4. 索引优化：根据实际查询场景，可对`purchase_date`+`status`、`sales_date`+`status`创建复合索引；
5. 数据归档：针对历史采购 / 销售数据，可建立归档表，定期迁移过期数据以提升主表查询性能。